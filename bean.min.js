/*!
  * bean.js - copyright Jacob Thornton 2011
  * https://github.com/fat/bean
  * MIT License
  * special thanks to:
  * dean edwards: http://dean.edwards.name/
  * dperini: https://github.com/dperini/nwevents
  * the entire mootools team: github.com/mootools/mootools-core
  */
!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("bean",function(){function K(a){var b=a.relatedTarget;return b?b!=this&&b.prefix!="xul"&&!/document/.test(this.toString())&&!q(this,b):b===null}var a=window,b=1,c={},d={},e=/over|out/,f=/[^\.]*(?=\..*)\.|.*/,g=/\..*/,h="addEventListener",i="attachEvent",j="removeEventListener",k="detachEvent",l=document||{},m=l.documentElement||{},n=m[h],o=n?h:i,p=function(a){return".__beanCustomNamespace_"+a.replace(/\./,"_")},q=function(a,b){var c=b.parentNode;while(c!==null){if(c==a)return!0;c=c.parentNode}},r=function(a,c){return a.__uid=c&&c+"::"+b++||a.__uid||b++},s=function(a){var b=r(a);return c[b]=c[b]||{}},t=n?function(a,b,c,d){a[d?h:j](b,c,!1)}:function(a,b,c,d,e){e&&d&&a["_on"+e]===null&&(a["_on"+e]=0),a[d?i:k]("on"+b,c)},u=function(b,c,d){return function(e){return e=H(e||((this.ownerDocument||this.document||this).parentWindow||a).event),c.apply(b,[e].concat(d))}},v=function(b,c,d,e,f){return function(g){if(e?e.apply(this,arguments):n?!0:g&&g.propertyName=="_on"+d||!g)g=g?H(g||((this.ownerDocument||this.document||this).parentWindow||a).event):null,c.apply(b,Array.prototype.slice.call(arguments,g?0:1).concat(f))}},w=function(b,c){return!n&&!c&&(b===l||b===a)?m:b},x=function(a,b,c,e){var h=b.replace(g,""),i=s(a),j=i[h]||(i[h]={}),k=c,l=r(c,b.replace(f,""));if(j[l])return a;var m=L[h];m&&(m.handler&&m.base?x(a,m.base+p(b),v(a,m.handler,m.base,m.condition)):(c=m.condition?v(a,c,h,m.condition):c,h=m.base||h));var q=J[h];c=q?u(a,c,e):v(a,c,h,!1,e),q=n||q;if(h=="unload"){var z=c;c=function(){y(a,h,c)&&z()}}return a=w(a,q),a[o]&&t(a,q?h:"propertychange",c,!0,!q&&h),j[l]=c,c.__uid=l,c.__originalFn=k,h=="unload"?a:d[r(a)]=a},y=function(a,b,e){function q(c){e=l[m][c];if(!e)return;delete l[m][c];if(a[o]){var d=L[m];d&&d.handler&&d.base?D(a,d.base+p(b)):m=d?d.base:m;var f=n||J[m];a=w(a,f),t(a,f?m:"propertychange",e,!1,!f&&m)}}var h=a.__uid,i,j,k,l=s(a),m=b.replace(g,"");if(!l||!l[m])return a;e&&e.__one&&(e=e.__one),i=b.replace(f,""),j=i?i.split("."):[e.__uid],q(i);for(k=j.length;k--;q(j[k]));return I(l[m])&&delete l[m],I(c[h])&&(delete c[h],delete d[h]),a},z=function(a,b,c){return function(d){var e=typeof a=="string"?c(a,this):a;for(var f=d.target;f&&f!=this;f=f.parentNode)for(var g=e.length;g--;)if(e[g]==f)return b.apply(f,arguments)}},A=function(a,b,c,d,e,f){if(typeof c=="object"&&!d)for(var g in c)c.hasOwnProperty(g)&&A(a,b,g,c[g]);else{var h=typeof d=="string",i=(h?d:c).split(" ");d=h?z(c,e,f):a=="one"?function(a){var d=function(){D(b,c,d),a.apply(this,arguments)};return a.__one=d}(d):d;for(var j=i.length;j--;)x(b,i[j],d,Array.prototype.slice.call(arguments,h?5:4))}return b},B=function(){return A.apply(this,["add"].concat(Array.prototype.slice.call(arguments,0)))},C=function(){return A.apply(this,["one"].concat(Array.prototype.slice.call(arguments,0)))},D=function(a,b,c){var d,e,h,i,j,k=typeof b=="string",l=k&&b.replace(f,""),m=y,n=s(a);l=l&&l.split(".");if(k&&/\s/.test(b)){b=b.split(" "),j=b.length-1;while(D(a,b[j])&&j--);return a}i=k?b.replace(g,""):b;if(!n||l||k&&!n[i]){for(d in n)if(n.hasOwnProperty(d))for(j in n[d])for(e=l.length;e--;)n[d].hasOwnProperty(j)&&(new RegExp("^"+l[e]+"::\\d*(\\..*)?$")).test(j)&&m(a,[d,j].join("."));return a}if(typeof c=="function")m(a,i,c);else if(l)m(a,b);else{m=i?m:D,h=k&&i,i=i?c||n[i]||i:n;for(d in i)i.hasOwnProperty(d)&&(m(a,h||d,i[d]),delete i[d])}return a},E=function(a,b,c){var d,e,h,i,j=b.split(" ");for(h=j.length;h--;){b=j[h].replace(g,"");var k=J[b],l=j[h].replace(f,""),m=s(a)[b];if(l){l=l.split(".");for(e=l.length;e--;)for(i in m)m.hasOwnProperty(i)&&(new RegExp("^"+l[e]+"::\\d*(\\..*)?$")).test(i)&&m[i].apply(a,[!1].concat(c))}else if(!c&&a[o])F(k,b,a);else for(e in m)m.hasOwnProperty(e)&&m[e].apply(a,[!1].concat(c))}return a},F=n?function(b,c,d){evt=document.createEvent(b?"HTMLEvents":"UIEvents"),evt[b?"initEvent":"initUIEvent"](c,!0,!0,a,1),d.dispatchEvent(evt)}:function(a,b,c){c=w(c,a),a?c.fireEvent("on"+b,document.createEventObject()):c["_on"+b]++},G=function(a,b,c){var d=s(b),e,f,g=r(a);e=c?d[c]:d;for(f in e)e.hasOwnProperty(f)&&(c?B:G)(a,c||b,c?e[f].__originalFn:f);return a},H=function(a){var b={};if(!a)return b;var c=a.type,d=a.target||a.srcElement;b.preventDefault=H.preventDefault(a),b.stopPropagation=H.stopPropagation(a),b.target=d&&d.nodeType==3?d.parentNode:d;if(~c.indexOf("key"))b.keyCode=a.which||a.keyCode;else if(/click|mouse|menu/i.test(c)){b.rightClick=a.which==3||a.button==2,b.pos={x:0,y:0};if(a.pageX||a.pageY)b.clientX=a.pageX,b.clientY=a.pageY;else if(a.clientX||a.clientY)b.clientX=a.clientX+l.body.scrollLeft+m.scrollLeft,b.clientY=a.clientY+l.body.scrollTop+m.scrollTop;e.test(c)&&(b.relatedTarget=a.relatedTarget||a[(c=="mouseover"?"from":"to")+"Element"])}for(var f in a)f in b||(b[f]=a[f]);return b},I=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};H.preventDefault=function(a){return function(){a.preventDefault?a.preventDefault():a.returnValue=!1}},H.stopPropagation=function(a){return function(){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}};var J={click:1,dblclick:1,mouseup:1,mousedown:1,contextmenu:1,mousewheel:1,DOMMouseScroll:1,mouseover:1,mouseout:1,mousemove:1,selectstart:1,selectend:1,keydown:1,keypress:1,keyup:1,orientationchange:1,touchstart:1,touchmove:1,touchend:1,touchcancel:1,gesturestart:1,gesturechange:1,gestureend:1,focus:1,blur:1,change:1,reset:1,select:1,submit:1,load:1,unload:1,beforeunload:1,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1},L={mouseenter:{base:"mouseover",condition:K},mouseleave:{base:"mouseout",condition:K},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}},M={add:B,one:C,remove:D,clone:G,fire:E},N=function(a){var b=D(a).__uid;b&&(delete d[b],delete c[b])};return a[i]&&B(a,"unload",function(){for(var b in d)d.hasOwnProperty(b)&&N(d[b]);a.CollectGarbage&&CollectGarbage()}),M.customEvents=L,M.noConflict=function(){return context.bean=old,this},M})